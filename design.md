# 项目设计文档

## 目录结构 

src/

## 贪吃蛇游戏需求分析要点

### 1. 游戏核心机制

#### 1.1 蛇的移动控制
- 蛇由头部和身体节点组成，每个节点占据一个网格
- 蛇以恒定速度向当前方向移动
- 每次移动时，头部向当前方向前进一格，其他身体节点跟随前一个节点的位置
- 蛇不能直接向相反方向移动（例如向右移动时不能直接向左转）
- 移动频率（速度）可随游戏进行而提升

#### 1.2 蛇的生长机制
- 初始状态蛇的长度为3个单位
- 当蛇头碰到食物时，蛇身长度增加1个单位
- 新增的身体节点在下一次移动时出现在蛇尾部
- 生长不会立即影响蛇的移动速度

#### 1.3 碰撞检测
- 边界碰撞：
  - 采用穿墙模式
  - 当蛇头碰到边界时，从对应的另一侧出现
  - 例如：从右边界消失则从左边界出现，保持同样的运动方向
- 自身碰撞：
  - 当蛇头碰到自己的身体时游戏结束
  - 碰撞判定以网格为单位进行检测

#### 1.4 食物生成规则
- 基础食物：
  - 随机出现在空白格子��
  - 同一时间只存在一个食物
  - 食物不能生成在蛇身上
  - 当食物被吃掉后，立即在新的随机位置生成下一个食物
- 特殊食物系统：
  - 特殊食物由固定字符组成："meiyun"
  - 每个字符作为一种特殊食物，具有不同效果：
    - 'm': 移动速度增加50%，持续10秒
    - 'e': 额外加3分
    - 'i': 使蛇身立即增长2个单位
    - 'y': 延长当前所有特效持续时间
    - 'u': 解锁特殊皮肤
    - 'n': 下一个普通食物必定生成在安全位置
  - 特殊食物出现规则：
    - 每吃掉5个普通食物后，随机出现一个特殊字符
    - 同一时间场上最多只能存在一个特殊食物
    - 特殊食物持续时间为10秒，超时后消失

#### 1.5 计分规则
- 基础食物：1分
- 特殊食物：
  - 'm': 2分
  - 'e': 3分
  - 'i': 2分
  - 'y': 3分
  - 'u': 5分
  - 'n': 2分
- 连续吃到食物有额外加分

### 2. 游戏界面设计

#### 2.1 游戏区域设计
- 游戏主区域：
  - 移动端优化网格：15×15的网格系统
  - 网格大小：自适应屏幕宽度（建议最小30×30像素）
  - 总体尺寸：根据屏幕宽度自适应（保持正方形）
  - 背景色：粉色系渐变，网格线使用浅粉色
  - 边角使用爱心装饰元素
- 游戏边框：
  - ��用心形图案组成的边框
  - 当蛇触碰边界时有爱心扩散动画效果

#### 2.2 游戏元素视觉表现
- 蛇的设计：
  - 蛇头：爱心形状，朝向为爱心尖端方向
  - 蛇身：小爱心连接，尾部带有爱心特效
  - 颜色：
    - 默认：粉红色渐变
    - 特殊状态：彩虹渐变效果
- 食物设计：
  - 普通食物：跳动的小爱心
  - 特殊食物：对应字母('m','e','i','y','u','n')
    - 使用可爱圆体字体
    - 每个字母周围环绕爱心特效
    - 字母颜色：
      - 'm': 玫瑰红
      - 'e': 粉红色
      - 'i': 紫色
      - 'y': 黄色
      - 'u': 蓝色
      - 'n': 绿色

#### 2.3 移动端优化UI布局
- 游戏区域：屏幕中央
- 顶部信息栏：
  - 左侧：爱心形状分数显示
  - 中间：游戏状态（带爱心装饰）
  - 右侧：最高分（爱心框装饰）
- 底部控制区：
  - 大型触控方向键（半透明爱心设计）
  - 左右两侧各占45%屏幕宽度
  - 左侧控制左右方向，右侧控制上下方向
- 暂停按钮：右上角爱心形状
- 状态显示区：
  - 使用爱心气泡展示特效状态
  - 倒计时使用爱心环绕动画

#### 2.4 动画效果
- 蛇的移动：
  - 爱心跳动效果
  - 移动时留下淡粉色轨迹
- 食物效果：
  - 生成时爱��放大动画
  - 持续漂浮跳动效果
- 特殊效果：
  - 得分时散落爱心粒子
  - 穿墙时产生爱心波纹
  - 游戏结束时爱心破碎效果
- 连击效果：
  - 连续吃到食物时出现彩虹爱心特效
  - 特效持续时间随连击数增加

#### 2.5 响应式设计与触控优化
- 触控操作：
  - 滑动灵敏度自适应
  - 最小滑动距离：屏幕宽度的10%
  - 触控反馈：爱心特效
- 屏幕适配：
  - 竖屏模式优先
  - 横屏自动调整布局
  - UI元素大小随屏幕等比缩放
- 安全区域：
  - 预留足够边距避免误触
  - 控制区域与游戏区域明确分隔

### 3. 控制系统

#### 3.1 移动端触控控制
- 主要控制方式：
  - 滑动控制：
    - 任意位置滑动即可控制方向
    - 滑动距离大于屏幕宽度10%才触发
    - 根据滑动角度判断方向（45度分割）
  - 虚拟按键控制：
    - 左右两侧半透明爱心形状按键
    - 左侧区域：控制左右方向
    - 右侧区域：控制上下方向
    - 按键面积占屏幕45%确保易于点击

- 触控反馈：
  - 触控时出现爱心涟漪效果
  - 方向改变时有轻微震动反馈
  - 无效操作（如反向移动）时显示提示动画

#### 3.2 键盘控制（备用）
- 方向键控制：
  - ↑↓←→ 控制��动方向
  - WASD 键作为备选控制
- 功能键：
  - 空格键：暂停/继续
  - ESC键：返回菜单
  - R键：快速重启
  - P键：截图分享

#### 3.3 游戏速度控制
- 基础速度：
  - 初始移动间隔：300ms
  - 最快移动间隔：100ms
- 速度变化机制：
  - 每吃到5个普通食物，速度提升10%
  - 特殊食物"m"触发后临时提升50%
  - 速度变化时有缓动效果，不会突兀
- 速度等级显示：
  - 当前速度用爱心等级图标显示
  - 提升时播放特效动画

#### 3.4 操作优化
- 输入缓冲：
  - 记录最近两次操作指令
  - 快速连续转向时保证平滑过渡
- 防误触设计：
  - 转向冷却时间：100ms
  - 反向操作自动忽略
  - 游戏区域外触控不影响游戏

#### 3.5 特殊控制
- 手势控制：
  - 双指捏合：缩放游戏画面
  - 双击屏幕：暂停/继续
  - 长按蛇头：显示预测路径
- 陀螺仪支持（可选）：
  - 设备倾斜控制方向
  - 灵敏度可调
  - 可在设置中开启/关闭

#### 3.6 辅助功能
- 操作指引：
  - 首次进入显示操作教程
  - 可随时查看操作说明
- 自定义控制：
  - 可调整触控灵敏度
  - 可更改按键大小
  - 可选择控制方式偏好
- 无障碍支持：
  - 支持系统无障碍服务
  - ��供音频反馈
  - 支持外接控制设备

### 4. 游戏状态

#### 4.1 游戏状态机制
- 基础状态：
  - INIT: 初始化状态
  - READY: 准备开始状态
  - PLAYING: 游戏进行中
  - PAUSED: 游戏暂停
  - ENDED: 游戏结束
- 状态转换规则：
  - INIT -> READY: 资源加载完成
  - READY -> PLAYING: 玩家触发开始
  - PLAYING <-> PAUSED: 暂停/继续
  - PLAYING -> ENDED: 游戏结束条件触发
  - ENDED -> READY: 重新开始

#### 4.2 初始化状态 (INIT)
- 资源预加载：
  - 加载图片资源
  - 加载音效资源
  - 加载字体资源
- 游戏配置初始化：
  - 读取本地存储数据
  - 设置初始参数
  - 初始化游戏网格
- 显示加载进度：
  - 爱心形状进度条
  - 加载完成动画效果

#### 4.3 准备状态 (READY)
- 界面展示：
  - 显示游戏标题
  - 显示开始按钮（爱心造型）
  - 显示最高分记录
- 初始设置：
  - 重置蛇的位置和长度
  - 清空特效状态
  - 重置分数计数
- 操作提示：
  - 显示操作引导
  - 展示新手教程（首次进入）

#### 4.4 游戏进行状态 (PLAYING)
- 游戏循环：
  - 处理用户输入
  - 更新游戏逻辑
  - 渲染画面
- 状态监控：
  - 蛇的位置和长度
  - 当前分数
  - 特效状态和持续时间
  - 连击次数
- 实时更新：
  - 更新分数显示
  - 更新特效状态
  - 更新速度等级

#### 4.5 暂停状态 (PAUSED)
- 暂停机制：
  - 停止游戏主循环
  - 保持当前游戏状态
  - 显示半透明遮罩
- 暂停界面：
  - 显示暂停菜单（爱心装饰）
  - 继续游戏按钮
  - 重新开始按钮
  - 返回主菜单按钮
- 额外功能：
  - 查看当前得分
  - 调整游戏设置
  - 查看操作说明

#### 4.6 结束状态 (ENDED)
- 结束条件：
  - 蛇碰到自身
  - 玩家主动结束
- 结束效果：
  - 播放结束动画（爱心破碎）
  - 显示最终得分
  - 显示游戏时长
- 结算界面：
  - 显示本局统计信息：
    - 最终长度
    - 吃到的食物数量
    - 特殊成就
  - 是否破纪录提示
  - 分享成绩按钮
  - 重新开始按钮
  - 返回主菜单按钮

#### 4.7 状态持久化
- 本地存储：
  - 最高分记录
  - 游戏设置
  - 解锁的皮肤
- 游戏进度：
  - 自动保存当前状态
  - 意外退出后可恢复
- 统计数据：
  - 游戏次数
  - 累计得分
  - 最长蛇身记录

### 5. 额外功能（可选）

#### 5.1 难度级别
- 提供多种难度选择：简单、普通、困难
- 难度影响蛇的初始速度和食物生成频率
- 困难模式下，增加障碍物随机生成

#### 5.2 计分系统
- 增加连击计分机制：连续吃到食物时，分数加成
- 提供每日、每周排行榜，激励玩家竞争
- 增加成就系统：完成特定任务可获得成就徽章

#### 5.3 最高分记录
- 本地存储最高分记录
- 提供云端同步功能，支持跨设备查看最高分
- 最高分界面增加分享功能，支持分享到社交媒体

#### 5.4 音效系统
- 增加背景音乐，支持多种风格选择
- 提供音效开关，玩家可自由选择是否开启音效
- 不同事件触发不同音效（如吃到食物、游戏结束）

#### 5.5 多人模式
- 支持本地双人对战模式，分屏显示
- 增加在线多人对战功能，支持匹配全球玩家
- 提供合作模式，玩家共同控制一条蛇，考验默契

#### 5.6 自定义皮肤
- 提供多种蛇和食物皮肤选择
- 通过游戏内货币或成就解锁新皮肤
- 支持玩家上传自定义皮肤

#### 5.7 社交互动
- 增加好友系统，支持添加好友和查看好友成绩
- 提供游戏内聊天功能，支持实时交流
- 定期举办游戏内活动，增加玩家互动

#### 5.8 数据统计
- 提供详细的游戏数据统计：游戏次数、平均分数、最长蛇身
- 支持导出数据，方便玩家分析和分享
- 增加数据可视化功能，直观展示玩家进步

### 6. 技术考虑

#### 6.1 游戏循环实现
- 采用 RequestAnimationFrame 实现游戏主循环
- 使用时间增量(delta time)控制游戏速度
- 实现游戏状态管理：
  - 使用状态机模式管理游戏状态
  - 确保状态转换的平滑性
  - 实现游戏暂停/继续功能
- 优化循环性能：
  - 使用对象池管理频繁创建/销毁的对象
  - 实现帧率控制，保持稳定的游戏体验

#### 6.2 动画流畅度
- 使用 CSS3 动画实现视觉效果：
  - Transform 和 Opacity 属性实现平滑过渡
  - 使用 will-change 提示浏览器优化
- 实现动画帧缓存：
  - 预渲染复杂动画帧
  - 使用 Canvas 离屏渲染
- 动画性能优化：
  - 避免重排(reflow)和重绘(repaint)
  - 使用 CSS 硬件加速
  - 实现动画节流和防抖

#### 6.3 响应式适配
- viewport 适配：
  - 使用 rem/vw 等相对单位
  - 实现屏幕自适应布局
- 多设备兼容：
  - 适配不同分辨率和屏幕比例
  - 支持横竖屏切换
  - 处理不同设备的触控事件
- 性能考虑：
  - 根据设备性能动态调整画质
  - 实现资源按需加载

#### 6.4 性能优化
- 资源加载优化：
  - 实现资源预加载策略
  - 使用 WebP 格式图片
  - 实现资源懒加载
- 渲染性能：
  - 使用 Canvas 或 WebGL 进行渲染
  - 实现视图层合成
  - 优化重绘区域
- 内存管理：
  - 及时释放不需要的资源
  - 控制内存使用上限
  - 实现垃圾回收优化

#### 6.5 数据存储
- 本地存储：
  - 使用 LocalStorage 存储游戏配置
  - 使用 IndexedDB 存储游戏数据
  - 实现数据定期同步和备份
- 云端存储：
  - 实现数据云同步功能
  - 处理多设备数据冲突
  - 确保数据安全性

#### 6.6 网络通信
- WebSocket 实现：
  - 处理实时多人对战
  - 实现断线重连机制
  - 优化网络延迟
- HTTP 请求优化：
  - 实现请求合并
  - 使用缓存策略
  - 处理网络异常

#### 6.7 代码架构
- 设计模式：
  - 使用观察者模式处理游戏事件
  - 使用策略模式处理不同难度级别
  - 使用工厂模式创建游戏对象
- 模块化：
  - 使用 ES6 模块化组织代码
  - 实现组件化开发
  - 保证代码可维护性
- 测试：
  - 编写单元测试
  - 实现自动化测试
  - 性能测试和监控

#### 6.8 安全性
- 前端安全：
  - 防止作弊行为
  - 实现数据加密
  - 防止 XSS 攻击
- 数据验证：
  - 服务端验证游戏数据
  - 检测异常行为
  - 实现防篡改机制

</rewritten_file>